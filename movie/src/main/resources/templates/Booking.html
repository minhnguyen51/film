<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Đặt Ghế Xem Phim</title>
    <link rel="stylesheet"
          href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/style.css">
    <style>

    </style>
</head>
<body>

<div class="container mt-5 text-center">
    <h2>Đặt Ghế Xem Phim</h2>

    <div class="screen">MÀN HÌNH</div>

    <div class="d-flex flex-column align-items-center">
        <!-- Ghế 5x5 -->
        <div id="seat-area">
            <!-- Dòng A đến E -->
            <div class="d-flex">
                <button class="seat" data-seat="A1">A1</button>
                <button class="seat" data-seat="A2">A2</button>
                <button class="seat" data-seat="A3">A3</button>
                <button class="seat" data-seat="A4">A4</button>
                <button class="seat disabled" disabled>A5</button>
            </div>
            <div class="d-flex">
                <button class="seat" data-seat="B1">B1</button>
                <button class="seat" data-seat="B2">B2</button>
                <button class="seat disabled" disabled>B3</button>
                <button class="seat" data-seat="B4">B4</button>
                <button class="seat" data-seat="B5">B5</button>
            </div>
            <div class="d-flex">
                <button class="seat" data-seat="C1">C1</button>
                <button class="seat" data-seat="C2">C2</button>
                <button class="seat" data-seat="C3">C3</button>
                <button class="seat" data-seat="C4">C4</button>
                <button class="seat" data-seat="C5">C5</button>
            </div>
            <div class="d-flex">
                <button class="seat" data-seat="D1">D1</button>
                <button class="seat" data-seat="D2">D2</button>
                <button class="seat" data-seat="D3">D3</button>
                <button class="seat" data-seat="D4">D4</button>
                <button class="seat" data-seat="D5">D5</button>
            </div>
            <div class="d-flex">
                <button class="seat" data-seat="E1">E1</button>
                <button class="seat disabled" disabled>E2</button>
                <button class="seat" data-seat="E3">E3</button>
                <button class="seat" data-seat="E4">E4</button>
                <button class="seat" data-seat="E5">E5</button>
            </div>
        </div>
    </div>

    <!-- Form đặt -->
    <form id="bookingForm" class="mt-4">
        <div class="form-group">
            <label>Họ tên:</label>
            <input type="text" id="name" class="form-control w-50 mx-auto" placeholder="Nhập họ tên">
        </div>
        <div class="form-group">
            <label>Ghế đã chọn:</label>
            <input type="text" id="seat" class="form-control w-50 mx-auto" readonly>
        </div>
        <button type="submit" class="btn btn-primary">Xác nhận đặt vé</button>
    </form>
    <a href="Homepage.html" class="btn btn-secondary back-button">
        ⬅ Quay lại
    </a>

    <div class="mt-4" id="result"></div>
</div>

<script>
    const seats = document.querySelectorAll('.seat:not(.disabled)');
    const seatInput = document.getElementById('seat');
    const result = document.getElementById('result');
    function getQueryParam(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }
    const movieId = getQueryParam('id');
    seats.forEach(seat => {
        seat.addEventListener('click', () => {
            seats.forEach(s => s.classList.remove('selected'));
            seat.classList.add('selected');
            seatInput.value = seat.getAttribute('data-seat');
        });
    });
    document.getElementById('bookingForm').addEventListener('submit', function (e) {
        e.preventDefault();
        const name = document.getElementById('name').value;
        const seat = seatInput.value;
        if (!name || !seat) {
            result.innerHTML = '<div class="alert alert-warning">Vui lòng điền họ tên và chọn ghế!</div>';
            return;
        }
        fetch('http://localhost:8080/api/bookings', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({seat_number: seat, rating: '', booking_time: null, movie_id: movieId, customer_name: name})
        })
        .then(res => res.json())
        .then(data => {
          result.innerHTML = `<div class="alert alert-success">✅ Đặt vé thành công!</div>`;
        })
        .catch(() => {
          result.innerHTML = `<div class="alert alert-danger">❌ Đặt vé thất bại!</div>`;
        });
    });
</script>

</body>
</html>
